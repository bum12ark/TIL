## ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì‹±ê¸€í†¤

- ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë³´í†µ ì—¬ëŸ¬ ê³ ê°ì´ ë™ì‹œì— ìš”ì²­ì„ í•œë‹¤.
- ìš”ì²­ì´ ì˜¬ ë•Œë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì€ ë§ì€ ë¹„ìš©ì´ ì‚¬ìš©ë˜ë©° íš¨ìœ¨ì ì´ì§€ ëª»í•˜ë‹¤.

### ìŠ¤í”„ë§ì´ ì—†ëŠ” ìˆœìˆ˜í•œ DI ì»¨í…Œì´ë„ˆ

```java
@Test
@DisplayName("ìŠ¤í”„ë§ ì—†ëŠ” ìˆœìˆ˜í•œ DI ì»¨í…Œì´ë„ˆ")
void pureContainer() {
    AppConfig appConfig = new AppConfig();
    // 1. ì¡°íšŒ: í˜¸ì¶œí•  ë•Œ ë§ˆë‹¤ ê°ì²´ ìƒì„±
    MemberService memberService1 = appConfig.getMemberService();
    // 2. ì¡°íšŒ: í˜¸ì¶œí•  ë•Œ ë§ˆë‹¤ ê°ì²´ ìƒì„±
    MemberService memberService2 = appConfig.getMemberService();

    // ì°¸ì¡°ê°’ì´ ë‹¤ë¥¸ ê²ƒì„ í™•ì¸
    System.out.println("memberService1 = " + memberService1);
    System.out.println("memberService2 = " + memberService2);
		
    // memberService1 != memberService2
    Assertions.assertThat(memberService1).isNotSameAs(memberService2);
}
```

```java
// ì½˜ì†” í™”ë©´
memberService1 = hello.core.member.MemberServiceImpl@5542c4ed
memberService2 = hello.core.member.MemberServiceImpl@1573f9fc
```

- ìœ„ì™€ ê°™ì´ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•  ê²½ìš° ì´ˆë‹¹ Nê±´ì˜ ìš”ì²­ì— Nê°œì˜ ê°ì²´ê°€ ìƒì„±ë˜ê³  ì†Œë©¸ëœë‹¤!
    - **ë©”ëª¨ë¦¬ ë‚­ë¹„ê°€ ì‹¬í•˜ë‹¤.**
- **í•´ê²°ë°©ì•ˆ**
    - í•´ë‹¹ ê°ì²´ëŠ” ìƒì„±ì‹œì—ë§Œ ë”± 1ê°œë§Œ ìƒì„±ë˜ê³ , ê³µìœ í•˜ë„ë¡ ì„¤ê³„í•˜ë©´ ëœë‹¤. â†’ **ì‹±ê¸€í†¤ íŒ¨í„´**

## ì‹±ê¸€í†¤ íŒ¨í„´

- í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë”± 1ê°œë§Œ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³´ì¥í•˜ëŠ” ë””ìì¸ íŒ¨í„´
- `private` ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ì—¬ **ì™¸ë¶€ì—ì„œ ì„ì˜ë¡œ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì„ ë§‰ëŠ”ë‹¤.**

### ì‹±ê¸€í†¤ ì˜ˆì œ ì½”ë“œ (SingletonService)

```java
public class SingleTonService {

    // 1. java ê°€ ëœ° ë•Œ ê°ì²´ë¥¼ ìƒì„± í•œë‹¤. (static ì˜ì—­)
    private static final SingleTonService instance = new SingleTonService();
		
		// 2. ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•  ë•ŒëŠ” ì•„ë˜ì˜ ë©”ì†Œë“œë¥¼ í†µí•´ ì¡°íšŒí•˜ë„ë¡ í—ˆìš©í•œë‹¤.
    public static SingleTonService getInstance() {
        return instance;
    }

    // 3. ê°ì²´ ì™¸ë¶€ ìƒì„± ë°©ì§€
    private SingleTonService() {};

    public void logic() {
        System.out.println("ì‹±ê¸€í†¤ ê°ì²´ ë¡œì§ í˜¸ì¶œ");
    }
    
}
```

1. static ì˜ì—­ì— ê°ì²´ instanceë¥¼ ë¯¸ë¦¬ í•˜ë‚˜ ìƒì„±í•´ì„œ ì˜¬ë ¤ë‘”ë‹¤.
2. ì´ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•˜ë©´ ì˜¤ì§ `getInstance()` ë©”ì†Œë“œë¥¼ í†µí•´ì„œë§Œ ì¡°íšŒ ê°€ëŠ¥í•˜ë‹¤. ì´ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ í•­ìƒ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.
3. ë”± 1ê°œì˜ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì¡´ì¬í•´ì•¼ í•˜ë¯€ë¡œ, ìƒì„±ìë¥¼ privateìœ¼ë¡œ ë§‰ì•„ì„œ í˜¹ì‹œë¼ë„ ì™¸ë¶€ì—ì„œ new í‚¤ì›Œë“œë¡œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ë§‰ëŠ”ë‹¤.

### ì‹±ê¸€í†¤ í…ŒìŠ¤íŠ¸

```java
@Test
@DisplayName("ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•œ ê°ì²´ ì‚¬ìš©")
void singletonServiceTest() {
    SingleTonService singleTonService1 = SingleTonService.getInstance();
    SingleTonService singleTonService2 = SingleTonService.getInstance();

    System.out.println("singleTonService1 = " + singleTonService1);
    System.out.println("singleTonService2 = " + singleTonService2);

    assertThat(singleTonService1).isSameAs(singleTonService2);
}
```

```java
// ì½˜ì†”
singleTonService1 = hello.core.singleton.SingleTonService@1165b38
singleTonService2 = hello.core.singleton.SingleTonService@1165b38
```

- **same**: ì°¸ì¡°ê°’ ë¹„êµ (`=`)
- **equal**: ê°’ ë¹„êµ (`equalTo`)

### ì‹±ê¸€í†¤ íŒ¨í„´ ë¬¸ì œì 

- ì‹±ê¸€í†¤ íŒ¨í„´ì„ êµ¬í˜„í•˜ëŠ” ì½”ë“œ ìì²´ê°€ ë§ì´ ë“¤ì–´ê°„ë‹¤.
- ì˜ì¡´ê´€ê³„ìƒ í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´í•œë‹¤. â†’ **DIP ìœ„ë°˜**
- í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´í•´ì„œ OCP ì›ì¹™ì„ ìœ„ë°˜í•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.
- í…ŒìŠ¤íŠ¸ê°€ ì–´ë µë‹¤.
- ë‚´ë¶€ ì†ì„±ì„ ë³€ê²½í•˜ê±°ë‚˜ ì´ˆê¸°í™”í•˜ê¸° ì–´ë µë‹¤.
- private ìƒì„±ìë¡œ ìì‹ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê¸° ì–´ë µë‹¤.
- ê²°ë¡ ì ìœ¼ë¡œ ì˜ì¡´ì„ì´ ë†’ì•„ì§„ë‹¤.
- ì•ˆí‹° íŒ¨í„´ìœ¼ë¡œ ë¶ˆë¦¬ê¸°ë„ í•œë‹¤.

## ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ (ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ)

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ë©´ì„œ, ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.

### ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ê°ì²´ ìƒì„± ê¸°ë³¸ ê°’ì€ **ì‹±ê¸€í†¤**
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ = ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆì˜ ì—­í• ì„ ìˆ˜í–‰
- **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì¥ì **
    - ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë‹¨ì ì„ í•´ê²° ê°€ëŠ¥
    - ì‹±ê¸€í†¤ íŒ¨í„´ì„ ìœ„í•œ ì§€ì €ë¶„í•œ ì½”ë“œê°€ ë“¤ì–´ê°€ì§€ ì•Šì•„ë„ ë¨
    - DIP, OCP, í…ŒìŠ¤íŠ¸, private ìƒì„±ìë¡œ ë¶€í„° ììœ ë¡­ê²Œ ì‹±ê¸€í†¤ì„ ì‚¬ìš© ê°€ëŠ¥

```java
@Test
@DisplayName("ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ ì‹±ê¸€í†¤")
void springContainer() {
    ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);
    // 1. ì¡°íšŒ: í˜¸ì¶œí•  ë•Œ ë§ˆë‹¤ ê°ì²´ ìƒì„±
    MemberService memberService1 = ac.getBean("memberService", MemberService.class);
    // 2. ì¡°íšŒ: í˜¸ì¶œí•  ë•Œ ë§ˆë‹¤ ê°ì²´ ìƒì„±
    MemberService memberService2 = ac.getBean("memberService", MemberService.class);

    // ì°¸ì¡°ê°’ì´ ë‹¤ë¥¸ ê²ƒì„ í™•ì¸
    System.out.println("memberService1 = " + memberService1);
    System.out.println("memberService2 = " + memberService2);

    // memberService1 != memberService2
    assertThat(memberService1).isSameAs(memberService2);
}
```

```java
// ì½˜ì†”
memberService1 = hello.core.member.MemberServiceImpl@2c532cd8
memberService2 = hello.core.member.MemberServiceImpl@2c532cd8
```

- ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì´ë¯¸ ë§Œë“¤ì–´ì§„ ê°ì²´ë¥¼ ê³µìœ í•´ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

## ì‹±ê¸€í†¤ ë°©ì‹ì˜ ì£¼ì˜ì 

- ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ë§Œ ìƒì„±í•´ì„œ ê³µìœ í•˜ëŠ” ì‹±ê¸€í†¤ ë°©ì‹ì€ ìƒíƒœë¥¼ ìœ ì§€(stateful)í•˜ê²Œ ì„¤ê³„í•˜ë©´ ì•ˆëœë‹¤.
- **ë¬´ìƒíƒœ(stateless)ë¡œ ì„¤ê³„í•´ì•¼ í•œë‹¤!**
    - íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ì— ì˜ì¡´ì ì¸ í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆëœë‹¤.
    - íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆëœë‹¤!
    - ê°€ê¸‰ì  ì½ê¸°ë§Œ ê°€ëŠ¥í•˜ì—¬ì•¼ í•œë‹¤.
    - í•„ë“œ ëŒ€ì‹ ì— ìë°”ì—ì„œ ê³µìœ ë˜ì§€ ì•ŠëŠ”, ì§€ì—­ë³€ìˆ˜, íŒŒë¼ë¯¸í„°, ThreadLocal ë“±ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- **ìŠ¤í”„ë§ ë¹ˆ í•„ë“œì— ê³µìœ ê°’ì„ ì„¤ì •í•˜ë©´ ì •ë§ í° ì¥ì• ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤!!!**

### ìƒíƒœë¥¼ ìœ ì§€í•  ê²½ìš° ë°œìƒí•˜ëŠ” ë¬¸ì œì  ì˜ˆì‹œ

```java
public class StatefulService {

    private int price; // ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” í•„ë“œ

    public void order(String name, int price) {
        System.out.println("name = " + name + " price = " + price);
        this.price = price; // ë¬¸ì œì !
    }

    public int getPrice() {
        return this.price;
    }

}
```

### í…ŒìŠ¤íŠ¸

```java
class StatefulServiceTest {

    @Test
    @DisplayName("ìƒíƒœ ìœ ì§€ ì‹±ê¸€í†¤ ì£¼ì˜ì ")
    void statefulServiceSingleton() throws Exception {
        ApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);
        StatefulService statefulService1 = ac.getBean("statefulService", StatefulService.class);
        StatefulService statefulService2 = ac.getBean("statefulService", StatefulService.class);

        // ThreadA: A ì‚¬ìš©ìê°€ 10000ì› ì£¼ë¬¸
        statefulService1.order("userA", 10000);
        // ThreadB: B ì‚¬ìš©ìê°€ 20000ì› ì£¼ë¬¸
        statefulService2.order("userB", 20000);

        // ThreadA: A ì‚¬ìš©ì ì£¼ë¬¸ ê¸ˆì•¡ ì¡°íšŒ
        int price1 = statefulService1.getPrice();
        // 10000ì›ì´ ì¡°íšŒë˜ëŠ” ê²ƒì´ ì•„ë‹Œ 20000ì› ì¡°íšŒ
        System.out.println("price1 = " + price1);

        assertThat(statefulService1.getPrice()).isEqualTo(20000);
    }

    static class TestConfig {

        @Bean
        public StatefulService statefulService() {
            return new StatefulService();
        }
    }
}
```

- `StatefulService`ì˜ `price` í•„ë“œëŠ” ê³µìœ ë˜ëŠ” í•„ë“œì¸ë°, íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ë³€ê²½í•œë‹¤.
- ì‹±ê¸€í†¤ ê°ì²´ì˜ ì „ì—­ë³€ìˆ˜ëŠ” ê°’ì´ ê³µìœ (ê³µìœ  í•„ë“œ)ë˜ë¯€ë¡œ ë¬´ìƒíƒœë¡œ ì„¤ê³„í•˜ì—¬ì•¼ í•œë‹¤.

## @Configurationê³¼ ì‹±ê¸€í†¤

```java
@Configuration
public class AppConfig {

    @Bean(name = "memberService")
    public MemberService getMemberService() {
        return new MemberServiceImpl(getMemberRepository());
    }

    @Bean(name = "orderService")
    public OrderService getOrderService() {
        return new OrderServiceImpl(getMemberRepository(), getDiscountPolicy());
    }

    @Bean(name = "memoryMemberRepository")
    public MemoryMemberRepository getMemberRepository() {
        return new MemoryMemberRepository();
    }

    @Bean(name = "discountPolicy")
    public DiscountPolicy getDiscountPolicy() {
        return new RateDiscountPolicy();
    }

}
```

1. @Bean getMemberService â†’ new MemoryMemberRepository();
2. @Bean getOrderService â†’ new MemoryMemberRepository();
- ì½”ë“œë¡œ ë´¤ì„ ë•Œ MemoryMemberRepositoryê°€ ë‘ë²ˆ í˜¸ì¶œë˜ì–´ ê°ê° ë‹¤ë¥¸ 2ê°œì˜ ê°ì²´ê°€ ìƒì„±ë˜ë©´ì„œ ì‹±ê¸€í†¤ì´ ê¹¨ì§€ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì¸ë‹¤.

### í…ŒìŠ¤íŠ¸

```java
@Test
@DisplayName("configuration ì‹±ê¸€í†¤ í…ŒìŠ¤íŠ¸")
public void configurationTest() throws Exception {
    ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

    MemberServiceImpl memberService = ac.getBean("memberService", MemberServiceImpl.class);
    OrderServiceImpl orderService = ac.getBean("orderService", OrderServiceImpl.class);
    MemberRepository memberRepository = ac.getBean("memoryMemberRepository", MemberRepository.class);

    MemberRepository memberRepository1 = memberService.getMemberRepository();
    MemberRepository memberRepository2 = orderService.getMemberRepository();

    System.out.println("memberService -> memberRepository1 = " + memberRepository1);
    System.out.println("orderService -> memberRepository2 = " + memberRepository2);
    System.out.println("memberRepository = " + memberRepository);
    
    // ëª¨ë‘ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ê³ í•˜ê³  ìˆë‹¤.
    assertThat(memberService.getMemberRepository()).isSameAs(memberRepository);
    assertThat(orderService.getMemberRepository()).isSameAs(memberRepository);
}
```

- memberRepositoryëŠ” 3ë²ˆ í˜¸ì¶œë˜ì–´ì•¼í•  ê²ƒ ì²˜ëŸ¼ ë³´ì¸ë‹¤.
1. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•˜ê¸° ìœ„í•´ @Beanì´ ë¶™ì–´ìˆëŠ” memberRepository() í˜¸ì¶œ
2. memberService() ë¡œì§ì—ì„œ memberRepository í˜¸ì¶œ
3. orderService() ë¡œì§ì—ì„œ memberRepository í˜¸ì¶œ

**ê·¸ëŸ°ë° ì¶œë ¥ ê²°ê³¼ëŠ” ëª¨ë‘ 1ë²ˆë§Œ í˜¸ì¶œëœë‹¤.**

```java
call AppConfig.getMemberService
call AppConfig.getMemberRepository
call AppConfig.getOrderService
```

## @Configurationê³¼ ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ì˜ ë§ˆë²•

- ìŠ¤í”„ë§ì€ ì‹±ê¸€í†¤ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ í´ë˜ìŠ¤ì˜ ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤.

**@Configurationì„ì ìš©í•œ AppConfig í´ë˜ìŠ¤ì˜ ì°¸ì¡°ê°’ì„ ì¶œë ¥í•´ë³´ì**

```java
@Test
@DisplayName("ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘")
void configurationDeep() {
    ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);
    AppConfig appConfig = ac.getBean(AppConfig.class);

    // class hello.core.AppConfig$$EnhancerBySpringCGLIB$$d6ae189e
    System.out.println("appConfig = " + appConfig.getClass());
}
```

- @Configuration ì• ë…¸í…Œì´ì…˜ì´ ë¶™ì—¬ìˆëŠ” í´ë˜ìŠ¤ì—ë§Œ CGLIBê°€ ì ìš©ëœë‹¤

# ğŸ“„ Reference

- [[ì¸í”„ëŸ°] ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬ - ê¸°ë³¸í¸ (ê¹€ì˜í•œ)](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%95%B5%EC%8B%AC-%EC%9B%90%EB%A6%AC-%EA%B8%B0%EB%B3%B8%ED%8E%B8/dashboard)
