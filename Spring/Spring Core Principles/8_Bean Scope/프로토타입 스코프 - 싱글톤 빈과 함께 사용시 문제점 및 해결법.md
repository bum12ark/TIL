# í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ - ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ ë¬¸ì œì  ë° í•´ê²°ë²•

ìƒì„±ì¼: 2021ë…„ 9ì›” 14ì¼ ì˜¤í›„ 4:24
íƒœê·¸: ë¹ˆ ìŠ¤ì½”í”„

## í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ - ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ ë¶„ì œì 

- í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•  ê²½ìš° í•­ìƒ ìƒˆë¡œìš´ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.
- í•˜ì§€ë§Œ ì‹±ê¸€í†¤ ë¹ˆ ì•ˆì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì‚¬ìš©í•  ê²½ìš° ì˜ë„ì¹˜ ì•Šì€ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ë¯€ë¡œ ì£¼ì˜ í•´ì•¼í•œë‹¤.

### í”„ë¡œí† íƒ€ì… ë¹ˆ ì§ì ‘ ìš”ì²­

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%90%E1%85%A9%E1%84%90%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20%E1%84%89%E1%85%B3%E1%84%8F%E1%85%A9%E1%84%91%E1%85%B3%20-%20%E1%84%89%E1%85%B5%E1%86%BC%E1%84%80%E1%85%B3%E1%86%AF%E1%84%90%E1%85%A9%E1%86%AB%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%80%E1%85%AA%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%81%E1%85%A6%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%89%E1%85%B5%2028f78fea2275431ca20e5f3465487ee8/Untitled.png)

1. í´ë¼ì´ì–¸íŠ¸Aê°€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆ ìš”ì²­
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ì—¬ ë°˜í™˜(@01). í•´ë‹¹ ë¹ˆì˜ count í•„ë“œ ê°’ì€ 0
3. í´ë¼ì´ì–¸íŠ¸ëŠ” ì¡°íšŒí•œ í”„ë¡œí† íƒ€ì… ë¹ˆì˜ addCount()ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ count í•„ë“œë¥¼ 1 ì¦ê°€ì‹œí‚´

â†’ í”„ë¡œí† íƒ€ì… ë¹ˆ(@01)ì˜ countëŠ” 1ì´ ë¨

1. í´ë¼ì´ì–¸íŠ¸Bê°€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆ ìš”ì²­
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒˆë¡œ ìƒì„±í•˜ì—¬ ë°˜í™˜(@02). í•´ë‹¹ ë¹ˆì˜ count í•„ë“œ ê°’ì€ 0
3. í´ë¼ì´ì–¸íŠ¸ëŠ” ì¡°íšŒí•œ í”„ë¡œí† íƒ€ì… ë¹ˆì˜ addCount()ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ count í•„ë“œë¥¼ 1ì¦ê°€ì‹œí‚´

â†’ í”„ë¡œí† íƒ€ì… ë¹ˆ(@02)ì˜ countëŠ” 1ì´ ë¨

### í…ŒìŠ¤íŠ¸ ì½”ë“œ

```java
@Test
void prototypeFindTest() {
    ConfigurableApplicationContext ac = new AnnotationConfigApplicationContext(PrototypeBean.class);

    PrototypeBean prototypeBean1 = ac.getBean(PrototypeBean.class);
    prototypeBean1.addCount();
    assertThat(prototypeBean1.getCount()).isEqualTo(1);

    PrototypeBean prototypeBean2 = ac.getBean(PrototypeBean.class);
    prototypeBean2.addCount();
    assertThat(prototypeBean2.getCount()).isEqualTo(1);
}

@Scope("prototype")
static class PrototypeBean {
    private int count = 0;

    public void addCount() {
        count++;
    }

    public int getCount() {
        return count;
    }

    @PostConstruct
    public void init() {
        System.out.println("PrototypeBean.init " + this);
    }

    @PreDestroy
    public void destroy() {
        System.out.println("PrototypeBean.destroy");
    }
}
```

## ì‹±ê¸€í†¤ ë¹ˆì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆ ì‚¬ìš©

- `ClientBean`ì´ë¼ëŠ” ì‹±ê¸€í†¤ ë¹ˆì´ ì˜ì¡´ê´€ê³„ ì£¼ì…ì„ í†µí•´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•˜ëŠ” ì˜ˆë¥¼ ì‚´í´ë³´ì

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%90%E1%85%A9%E1%84%90%E1%85%A1%E1%84%8B%E1%85%B5%E1%86%B8%20%E1%84%89%E1%85%B3%E1%84%8F%E1%85%A9%E1%84%91%E1%85%B3%20-%20%E1%84%89%E1%85%B5%E1%86%BC%E1%84%80%E1%85%B3%E1%86%AF%E1%84%90%E1%85%A9%E1%86%AB%20%E1%84%87%E1%85%B5%E1%86%AB%E1%84%80%E1%85%AA%20%E1%84%92%E1%85%A1%E1%86%B7%E1%84%81%E1%85%A6%20%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%89%E1%85%B5%2028f78fea2275431ca20e5f3465487ee8/Untitled%201.png)

- `clientBean`ì€ ì‹±ê¸€í†¤ ë¹ˆìœ¼ë¡œì¨, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„± ì‹œì ì— í•¨ê»˜ ìƒì„±ë˜ê³ , ì˜ì¡´ê´€ê³„ ì£¼ì…ë„ ë°œìƒí•œë‹¤.
1. `clientBean`ì´ ìƒì„±ëœ ì´ í›„ ì˜ì¡´ê´€ê³„ ìë™ ì£¼ì…ì„ í†µí•´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìš”ì²­í•œë‹¤.
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ì—¬ `clientBean`ì— ë°˜í™˜í•œë‹¤.
    - clientBeanì€ í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ì°¸ì¡°ê°’ì„ ë‚´ë¶€ í•„ë“œì— ë³´ê´€í•œë‹¤.
    - í´ë¼ì´ì–¸íŠ¸ AëŠ” `clientBean`ì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•˜ì—¬ ë°˜í™˜ ë°›ëŠ”ë‹¤.
    - ì‹±ê¸€í†¤ì´ë¯€ë¡œ í•­ìƒ ê°™ì€ `clientBean`ì´ ë°˜í™˜
3. í´ë¼ì´ì–¸íŠ¸ Aê°€ `clientBean.logic()`ì„ í˜¸ì¶œ
4. `clientBean`ì€ prototypeBeanì˜ `addCount()`ë¥¼ í˜¸ì¶œí•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì˜ countë¥¼ ì¦ê°€í•˜ì—¬ count ê°’ì€ 1ê°€ ëœë‹¤.
    - í´ë¼ì´ì–¸íŠ¸ BëŠ” `clientBean`ì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•´ì„œ ë°›ëŠ”ë‹¤. ì‹±ê¸€í†¤ ë¹ˆìœ¼ë¡œì¨ í•­ìƒ ê°™ì€ `clientBean`ì´ ë°˜í™˜ëœë‹¤.
5. í´ë¼ì´ì–¸íŠ¸ BëŠ” `clientBean.logic()`ì„ í˜¸ì¶œ
6. `clientBean`ì€ prototypeBeanì˜ `addCount()`ë¥¼ í˜¸ì¶œí•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì˜ countë¥¼ ì¦ê°€í•˜ì—¬ count ê°’ì€ 2ê°€ ëœë‹¤.
    - **clientBeanì´ ë‚´ë¶€ì— ê°€ì§€ê³  ìˆëŠ” í”„ë¡œí†  íƒ€ì… ë¹ˆì€ ì´ë¯¸ ê³¼ê±°ì— ì£¼ì…ì´ ëë‚œ ë¹ˆì´ë‹¤.**
    - **ì£¼ì… ì‹œì ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•˜ì—¬ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒˆë¡œ ìƒì„±ëœ ê²ƒì´ì§€, ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìƒì„±ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤!**

### í…ŒìŠ¤íŠ¸ ì½”ë“œ

```java
@Test
@DisplayName("ì‹±ê¸€í†¤ ë¹ˆì•ˆì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì£¼ì…ë°›ì•„ì„œ ì‚¬ìš©í•  ê²½ìš°")
void singleTonClientUsePrototype() {
    ConfigurableApplicationContext ac = new AnnotationConfigApplicationContext(ClientBean.class, PrototypeBean.class);
    ClientBean clientBean1 = ac.getBean(ClientBean.class);
    int count1 = clientBean1.logic();
    assertThat(count1).isEqualTo(1);

    // í”„ë¡œí† íƒ€ì… ë¹ˆì€ ìƒˆë¡œ ë§Œë“¤ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤. (ì‹±ê¸€í†¤ë¹ˆì´ ìƒì„±ë  ë•Œ ì£¼ì…ë˜ì–´ìˆê¸° ë•Œë¬¸)
    ClientBean clientBean2 = ac.getBean(ClientBean.class);
    int count2 = clientBean2.logic();
    assertThat(count2).isEqualTo(2);
}

@Scope("singleton")
@RequiredArgsConstructor
static class ClientBean {
    private final PrototypeBean prototypeBean; // ìƒì„± ì‹œì ì— ì£¼ì…

    public int logic() {
        prototypeBean.addCount();
        return prototypeBean.getCount();
    }
}

@Scope("prototype")
static class PrototypeBean {
    private int count = 0;

    public void addCount() {
        count++;
    }

    public int getCount() {
        return count;
    }

    @PostConstruct
    public void init() {
        System.out.println("PrototypeBean.init " + this);
    }

    @PreDestroy
    public void destroy() {
        System.out.println("PrototypeBean.destroy");
    }
}
```

- ì‹±ê¸€í†¤ ë¹ˆì´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì‚¬ìš©í•˜ê²Œ ë  ê²½ìš° í”„ë¡œí†  íƒ€ì… ë¹ˆê³¼ í•¨ê»˜ ê³„ì† ìœ ì§€ëœë‹¤.
- í”„ë¡œí† íƒ€ì… ë¹ˆì€ ìš”ì²­ ì‹œì ì— ìƒì„±ë˜ëŠ” ê²ƒì´ê³ , ì‹±ê¸€í†¤ ë¹ˆì€ í•œë²ˆë§Œ ìš”ì²­ì„ ë°›ìœ¼ë¯€ë¡œ í”„ë¡œí† íƒ€ì… ë¹ˆ ë˜í•œ í•œë²ˆ ì£¼ì…ëœ í›„ì— ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤.

## Providerë¡œ ë¬¸ì œ í•´ê²°

- ì‹±ê¸€í†¤ ë¹ˆê³¼ í”„ë¡œí† íƒ€ì… ë¹ˆì„ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•´ë³´ì

### ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­

```java
@Scope("singleton")
static class ClientBean {
    
    @Autowired
    private ApplicationContext applicationContext;

    public int logic() {
        PrototypeBean prototypeBean = applicationContext.getBean(PrototypeBean.class);
        prototypeBean.addCount();
        return prototypeBean.getCount();
    }
}
```

- ApplicationContextë¥¼ ì£¼ì…ë°›ì•„ getBean() ë©”ì†Œë“œë¥¼ í†µí•´ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí†  íƒ€ì… ë¹ˆì„ ë°˜í™˜ ë°›ëŠ”ë‹¤.
- ì˜ì¡´ê´€ê³„ë¥¼ ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ëŠ”ê²Œ ì•„ë‹ˆë¼ ì§ì ‘ í•„ìš”í•œ ì˜ì¡´ê´€ê³„ë¥¼ ì°¾ëŠ” ê²ƒì„ **Dependecy LookUp (DL) ì˜ì¡´ê´€ê³„ ì¡°íšŒ(íƒìƒ‰) ì´ë¼ í•œë‹¤.**
- **ë‹¨ì **
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì¢…ì†ì ì¸ ì½”ë“œ
    - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜ ì–´ë ¤ì›€
- **í•´ê²°ë²•**
    - **DL**ì˜  ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë¬´ì–¸ê°€ë¥¼ ì‚¬ìš©í•´ë³´ì!

### ObjectFactory, ObjectProvider

- ì§€ì •í•œ ë¹ˆì„ ì»¨í…Œì´ë„ˆ ëŒ€ì‹  ì°¾ì•„ì£¼ëŠ” DL ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤.
- ê³¼ê±° `ObjectFactory`ì— í¸ì˜ ê¸°ëŠ¥ì„ ì¶”ê°€í•œ `ObjectProvider`ê°€ ë§Œë“¤ì–´ì¡Œë‹¤.

```java
@Test
void providerTest() {
    ConfigurableApplicationContext ac = new AnnotationConfigApplicationContext(ClientBean.class, PrototypeBean.class);

    ClientBean clientBean1 = ac.getBean(ClientBean.class);
    int count1 = clientBean1.logic();
    assertThat(count1).isEqualTo(1);

    ClientBean clientBean2 = ac.getBean(ClientBean.class);
    int count2 = clientBean2.logic();
    assertThat(count2).isEqualTo(1);
}

@Scope("singleton")
@RequiredArgsConstructor
static class ClientBean {
    private final ObjectProvider<PrototypeBean> prototypeBeanProvider;

    public int logic() {
        PrototypeBean prototypeBean = prototypeBeanProvider.getObject();
        prototypeBean.addCount();
        return prototypeBean.getCount();
    }
}
```

- `prototypeBeanProvider.getObject()`ë¥¼ í†µí•´ì„œ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒì„±ëœë‹¤.
- ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ê¸°ëŠ¥ì´ ë‹¨ìˆœí•˜ë¯€ë¡œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê±°ë‚˜ mock ì½”ë“œë¥¼ ë§Œë“¤ê¸° í›¨ì”¬ ì‰¬ì›Œì§„ë‹¤.
- `ObjectProvider`ëŠ” **DL** ì •ë„ì˜ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
- **íŠ¹ì§•**
    - ObjectFactory: ê¸°ëŠ¥ì´ ë‹¨ìˆœ, ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© X, ìŠ¤í”„ë§ì— ì˜ì¡´
    - ObjectProvider: ObjectFactory ìƒì†, ì˜µì…˜, ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ ë“±ì˜ í¸ì˜ê¸°ëŠ¥ ì œê³µ, ìŠ¤í”„ë§ì— ì˜ì¡´
	
# ğŸ“„ Reference

- [[ì¸í”„ëŸ°] ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬ - ê¸°ë³¸í¸ (ê¹€ì˜í•œ)](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%95%B5%EC%8B%AC-%EC%9B%90%EB%A6%AC-%EA%B8%B0%EB%B3%B8%ED%8E%B8/dashboard)